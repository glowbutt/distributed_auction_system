syntax = "proto3";

package auction;

option go_package = "auction-system/proto";


message BidRequest {
  string bidder_id = 1;
  int32 amount = 2;
}

message BidResponse {
  enum Status {
    SUCCESS = 0;
    FAIL = 1;
    EXCEPTION = 2;
  }
  Status status = 1;
  string message = 2;
}

message ResultRequest {
  string bidder_id = 1;
}

message ResultResponse {
  bool auction_over = 1;
  string winner = 2;
  int32 highest_bid = 3;
  string message = 4;
}

// Replication messages
message ReplicateBidRequest {
  string bidder_id = 1;
  int32 amount = 2;
  int64 timestamp = 3;
  int64 sequence_number = 4;
}

message ReplicateBidResponse {
  bool success = 1;
}

message BidEntry {
  string bidder_id = 1;
  int32 amount = 2;
  int64 timestamp = 3;
}

message RemovePeerRequest {
  string address = 1;
}

message RemovePeerResponse {
  bool success = 1;
  string message = 2;
}

message MakeNewLeaderRequest {
  string address = 1;
}

message MakeNewLeaderResponse {
  bool success = 1;
  string message = 2;
}

message RequestVoteRequest {
  int64 Term = 1;
  string CandidateId = 2;
  int64 LastSeq = 3; // last applied sequence number / log index for up-to-dateness check
}

message RequestVoteResponse {
  int64 Term = 1;        // the responder's current term (may be updated)
  bool VoteGranted = 2;  // true if vote granted to candidate
}

// auction service for clients
service Auction {
  rpc Bid(BidRequest) returns (BidResponse);
  rpc Result(ResultRequest) returns (ResultResponse);
}

// internal replication service between nodes
service Replication {
  rpc RequestVote(RequestVoteRequest) returns (RequestVoteResponse);
  rpc MakeNewLeader(MakeNewLeaderRequest) returns (MakeNewLeaderResponse);
  rpc RemovePeer(RemovePeerRequest) returns (RemovePeerResponse);
  rpc ReplicateBid(ReplicateBidRequest) returns (ReplicateBidResponse);
}